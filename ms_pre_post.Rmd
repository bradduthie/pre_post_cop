---
title: "Evolution of precopulatory and postcopulatory inbreeding behaviour"
author: "A. Bradley Duthie et al."
date: "August 24, 2016"
output:
  pdf_document:
    fig_caption: yes
  html_document: default
  word_document: null
linestretch: 1
bibliography: ms_pre_post.bib
---


******************************

```{r, echo=FALSE}
figscale <- 1.0; # Change the scale of a figure
```


Abstract
===================================================



Introduction
===================================================

Here we apply a model of female and male reproductive interactions and associated inbreeding depression in offspring viability to quantify evolution of three separate traits including female tendency for polyandry, female pre-copulatory inbreeding strategy (mating strategy), and female post-copulatory inbreeding strategy (fertilisation strategy). We use *in silico* experiments to test the hypotheses that evolution of post-copulatory inbreeding avoidance facilitates evolution of polyandry, and that evolution of pre-copulatory versus post-copulatory inbreeding avoidance can be predicted by the relative costs of each, and the relative cost of polyandry. We thereby provide a framework for predicting evolution of pre-copulatory and post-copulatory inbreeding avoidance across reproductive systems with different relative costs and different magnitudes of inbreeding depression in offspring viability.


******************************

Model
===================================================

We track interactions among discrete individuals in a small focal population that persists over multiple generations. Individuals within this population are either female or male, and are potentially related if they share a common ancestory. We record the coefficient of kinship ($k$), defined as the probability that a randomly selected homologous allele from each individual is identical-by-descent [@Lynch1998], between all pairs of individuals in each generation using the population pedigree [see @Boyce1983; @Duthie]. At the start of each generation, each female pays up to three independent costs of (1) tendency to engage in polyandry ($c_{P}$), (2) mating strategy with respect to inbreeding ($c_{M}$), and (3) fertilisation strategy ($c_{F}$) with respect to inbreeding. The number of males that a focal female mates with ($N_{males}$) is determined by the effects of 20 alleles ($P_{a}$) across 10 diploid loci that combine additively to determine a her genotype ($P_{g}$), and ultimately the phenotype for her tendency to engage in polandry ($P_{p}$). A focal female's choice of mate(s) is affected by 20 alleles ($M_{a}$) across 10 diploid loci that combine additively to affect her genotype ($M_{g}$) and phenotype ($M_{p}$) for pre-copulatory inbreeding avoidance or preference, and $k$ between the focal female and her potential mates. Similarly, after mating has occurred, post-copulatory fertilisation of a focal female's $n$ total offspring is affected by 20 alleles ($F_{a}$) across 10 diploid loci that combine additively to affect the genotype ($F_{g}$) and phenotype ($F_{p}$) of the degree to which fertilisation success is affected by $k$. After fertilisation, the vialbility of a focal female's $n$ offspring is decreased by inbreeding depression ($\beta$); surviving offspring become adults. After inbreeding depression in offspring, $\rho$ adult male immigrants arrive in the population, then density effects reduce the entire population down to female ($K_{f}$) and male ($K_{m}$) carrying capacity. Over generations, we record mean values of alleles underlying polyandry, mating strategy, and fertilisation strategy.

Costs
----------------------------------------------

Values of phenotypic traits for tendency to engage in polyandry ($P_{p}$), mating ($M_{p}$), and fertilistation ($F_{p}$) each have costs, which independently increase the probability of a focal female's reproductive failure. These costs are all expressed prior to mating. In the case of tendency to engage in polyandry and inbreeding mating strategy, costs of $P_{p}$ ($c_{P}$) and $M_{p}$ ($c_{M}$) are interpreted biologically as costs associated with mate searching or courtship [e.g., @Rowe1988; @Rowe1994; @Ronkainen1994; @Koga1998; @Lasley-Rasher2012]. In the case of inbreeding fertilisation strategy, the cost of $F_{p}$ ($c_{F}$) is interpreted as an energetic cost associated with the physiological or biochemical mechanisms that need to be developed to bias fertilsation for inbreeding avoidance or inbreeding preference [e.g., @Gasparini2011]. Each cost independently increases the risk of female pre-mating mortality and, because generations are non-overlapping, total reproductive failure as a linear function of its associated trait. The probability that a focal female dies before mating due to the cost of polyandry is therefore $P_{p} \times c_{P}$. Similarly, the probability of pre-mating female mortality due to the cost of mating strategy and fertilisation strategy is $|M_{p}| \times c_{M}$ and $|F_{p}| \times c_{F}$, repectively, where $|M_{p}|$ is the absolute value of $M_{p}$ and $|F_{p}|$ is the absolute value of $F_{p}$. Absolute values are used for applying costs to inbreeding strategies because both negative and positive $M_{p}$ and $F_{p}$ bias breeding interactions with respect to kinship, while only positive values of $P_{p}$ affect a female's tendency for polyandry; zero and negative $P_{p}$ values always translate to monandrous phenotypes (see below).

Polyandry
----------------------------------------------

Each female chooses a number of males to mate with ($N_{males}$) based on her genetically determined tendency to engage in polyandry ($P_{p}$). The exact value of $N_{males}$ is calculated by sampling from a random poisson distribution such that $N_{males} = Poisson(P_{p}) + 1$. This random sampling procedure causes some stochastic variation in the number of realised mates a that female chooses, with a mean $N_{males}$ of $P_{p}+1$. A one is added to $P_{p}$ to ensure that all females choose at least one mate, as low values of $P_{p}$ might return $Poisson(P_{p})$ values of zero.

The value of $P_{p}$ is affected by the summed values of her 20 $P_{a}$ alleles. Inheritence of all alleles models a diploid genetic architecture in which 10 $P_{a}$ alleles are randomly sampled from each parent with no physical linkage. Values of $P_{a}$ can take any real number [continuum-of-alleles model; @Kimura1965; @Lande1976; @Reeve2000; @Bocedi2014]. The tendency for polyandry genotype $P_{g}$ is defined by the sum of all of a focal female's 20 $P_{a}$ values, which might be negative or positive. However, the tendency for polyandry phenotype $P_{p}$ is restricted to zero or positive values because the number of males that a female chooses to mate with cannot be negative. Hence, negative values of $P_{g}$ are translated to $P_{p}$ values of zero such that $P_{p} = 0$ when $P_{g} < 0$, but when $P_{g} \geq 0$, then $P_{p} = P_{g}$ (i.e., the phenotype value of polyandry equals the genotype value of polyandry if and only if the genotype value is greater than or equal to zero, else the phenotype value of polyandry always equals zero). The resulting $P_{p}$ is therefore modelled as a threshold trait [@Lynch1998; @Roff1996; @Roff1998], in which polyandry is expressed discretely at the threshold value of $P_{g} > 0$, but is determined by the consequence of continuous genetic variation arising from the effects of $P_{a}$ alleles that each contribute additively to a female's tendency toward polyandry. Negative genotypic values of $P_{g}$ therefore all have the same phenotype, resulting in consistently monandrous females. In contrast, positive values of $P_{g}$ and therefore $P_{p}$ can lead to different degrees of realised polyandry in the form of discrete numbers of mates ($N_{males}$).

Mating
----------------------------------------------

Each male within the population is a potential mate for any female to choose. We therefore assume that there are no opportunity costs associated with male mating such that mating with one female would reduce a male's ability to mate with and sire the offspring of any other female [e.g., @Waser1986]. While all males are therefore available as potential mates, we assume that a female mates with her total allotment of $N_{males}$ without replacement, meaning that $N_{males}$ models the total number of distinct males that a female chooses to mate with rather than the number of times that she mates. In the unlikely event that a female's $N_{males}$ exceeds the total number of males in the population, then she mates with all of the males in the populaton. Most often, $N_{males}$ will be a small subset of the available males in the population [@Duthie], so a focal female will be able to preferentially mate with males that are close kin (high $k$), distant kin (low $k$), or non-kin ($k=0$) through the expression of her mating phenotype ($M_{p}$). Like polyandry allele values, mating strategy allele values ($M_{a}$) can take any real number. However, unlike polyandry, the sum of all of a female's 20 $M_{a}$ alleles equals both her mating strategy genotype ($M_{g}$) and her mating strategy phenotype ($M_{p}$). Negative or positive values of $M_{p}$ cause a female to avoid or prefer mating with kin, respectively. Values of $M_{p}=0$ causes females to mate randomly with respect to kinship.

The probability that a focal female $i$ mates with a male $j$ with which she shares some kinship $k_{ij}$ is calculated by first assigning each male a perceived mate quality $Q^{m}_{ij}$. This quality depends upon whether the female has a strategy of avoiding mating with kin ($M_{p}<0$) or preferring mating with kin ($M_{p}>0$; if $M_{p}=0$, all males are assigned a quality of 1, $Q^{m}_{ij}=1$). If a focal female avoids mating with kin, then $Q^{m}_{ij} = (-M_{p} \times k_{ij} + 1)^{-1}$, meaning that the perceived quality of a male decreases lineary with increasingly positive values of $k_{ij}$ and increasingly negative values of $M_{p}$. If a focal female prefers mating with kin, then $Q^{m}_{ij} = M_{p} \times k_{ij} + 1$, meaning that the perceived quality of a male increases with increasingly positive values of $k_{ij}$ and $M_{p}$. After a focal female assigns all males a perceived quality, the sum of all male perceived qualities is calculated, then each male quality is divided by this sum. This transformation results in each male having a relative perceived mate quality $q^{m}_{ij}$, which is constrained to values between zero and one. The value of $q^{m}_{ij}$ then defines the probability that a female chooses the male as a mate; female choice is therefore stochastic, meaning that females do not always choose the male of the highest $q^{m}_{ij}$. For polyandrous females that choose more than one male mate, mates are chosen iteratively such that $Q^{m}_{ij}$ and $q^{m}_{ij}$ are re-calculated for each additional mate choice, and with $Q^{m}_{ij}$ and therefore $q^{m}_{ij}$ values of already chosen males set to zero to ensure mate sampling without replacement.

Fertilisation
----------------------------------------------

The fertilisation of a female's $n$ offspring occurs after mating, with each of her $n$ offspring being assigned a sire independently and with replacement from the $N_{males}$ with which the female mated. The probability that a male mate successfully sires an offspring is affected by a female's kinship with the potential sire ($k_{ij}$) and her inbreeding fertilisation strategy ($F_{p}$). As with polyandry and inbreeding mating strategy phenotypes, a female's inbreeding fertilisation strategy phenotype is determined by the summed effects of 20 inbreeding fertilisation strategy alleles ($F_{a}$), which can take any real number. The sum of all of a female's $F_{a}$ alleles determine her inbreeding fertilisation strategy genotype ($F_{g}$), which is identical to her inbreeding strategy phenotype ($F_{p}$). As with mating strategy phenotype ($M_{p}$), negative or positive values of $F_{p}$ correspond to inbreeding avoidance or preference respectively, and $F_{p}=0$ causes random fertilisation with respect to kinship. 

The probability that an offspring of a focal female $i$ is fertilised by one of $i$'s mates $j$ is calculated by first assigning a perceived fertilisation quality to each $j$, $Q^{f}_{ij}$. Perceived fertilisation quality $Q^{f}_{ij}$ is calculated in the same way as perceived mate quality $Q^{m}_{ij}$, such that if a focal female has a fertilisation strategy of avoiding inbreeding ($F_{p}<0$), then the perceived quality of male $j$ is $Q^{f}_{ij} = (-F_{p} \times k_{ij} + 1)^{-1}$. If instead a focal female has a fertilisation strategy of preferring inbreeding ($F_{p}>0$), then the perceived quality of male $j$ is $Q^{f}_{ij} = F_{p} \times k_{ij} + 1$. The perceived qualities of every male that a focal female has mated with are summed, then a relative quality ($q^{f}_{ij}$) is calculated for each male by dividing each individual male mate's $Q^{f}_{ij}$ by this sum. As with relative perceived mate quality values ($q^{m}_{ij}$), this results in values of perceived fertilisation quality $q^{f}_{ij}$ between zero and one. These $q^{f}_{ij}$ values define the probability that the offspring of a focal female $i$ is fertilised by the male $j$. Females produce $n$ offspring, meaning that $q^{f}_{ij}$ values are sampled $n$ times for each female to determine the realised distribution of sires.

Mutation
----------------------------------------------

Alleles of a focal female's offspring mutate with a probability of $\mu=0.001$, with mutation being an independent event across loci. In general, loss of function mutations might be expected to be more frequent than mutations that increase the functionality of adaptations that rely on complex physiologies or behaviours. If tendency for polyandry, inbreeding mating strategies, or inbreeding fertilisation strategies rely on such complex physiologies or behaviours, then we might expect the direction of mutation to be biased (e.g., towards monandry or random mating). However, because we are interested specifically in how selection affects reproductive strategy given varying costs and inbreeding depression, we model mutation as unbiased so that selection can be isolated and inferred clearly from mean allele values.

Hence, when a mutation occurs at a loci, a new value is sampled from a random normal distribution with a mean of zero, $\mathcal{N}(0, \mu_{SD})$. This new value is then added to the original value of the allele that mutates [@Kimura1965; @Lande1976; @Bocedi2014; @Duthie]. The standard deviation of the mutation effect size ($\mu_{SD}$) is set to $\sqrt{1/20}$, which scales the variance of mutation effect size to the total number of alleles affecting $P_{p}$, $M_{p}$, and $F_{p}$ phenotypes [see @Kimura1965; @Lande1976; @Bocedi2014].

Inbreeding depression
----------------------------------------------

The viability of a focal female $i$'s offspring ($\Psi_{\textrm{off}}$) decreases as a function of the kinship coefficient between $i$ and the sire of her offspring $j$ ($k_{ij}$), and a log-linear slope of inbreeding depression $\beta$. We model selection as having an absolute effect on offspring viability (i.e., hard selection), rather than a relative effect on viability (i.e., soft selection), so that the effect of $\beta$ is consistent over generations and across different parameter combinations. Natural selection on tendency for polyandry ($P_{p}$), inbreeding mating strategy ($M_{p}$), and inbreeding fertilisation strategy ($F_{p}$) can therefore be compared with respect to log-linear inbreeding depression slopes across generations and parameter combinations. If offspring viability was instead relative such that the least inbred offspring had a high viability regardless of the absolute value of $k_{ij}$, then the effect of kinship coefficients and inbreeding depression slopes on offspring viability would depend on the population-wide distribution of $k_{ij}$ between females and males, making model inference more difficult. Therefore, we define offspring viability as,
\begin{equation}
\Psi_{\textrm{off}} = e^{-\beta k_{ij}}
\end{equation}
The slope $\beta$ models the number of haploid lethal equivalents that exist in the gametes of $i$ and $j$, and which might combine to become homozygous in offspring and reduce viability. Equation 1 assumes that each deleterious recessive allele affects offspring viability independently, meaning that every deleterious recessive allele added will have a multiplicative affect on decreasing viability [@Morton1956; @Mills1994], causing the log-linear relationship between parent kinship and inbreeding depression. We assume that inbreeding depression always decreases offspring viability, $\beta \geq 0$ (i.e., no outbreeding depression). Therefore, because $k_{ij}$ is constrained to values between zero and one, the product of $-\beta$ and $k_{ij}$ must be a value less than or equal to zero, $-\beta \times k_{ij} \leq 0$. Values of $\Psi_{\textrm{off}}$ must therefore be between zero and one. We can therefore define $\Psi_{\textrm{off}}$ as the probability that an offspring is viable, and sample its realised viability using a Bernoulli trial.

Immigration
----------------------------------------------

After offspring viability is realised, $\rho$ adult immigrants are added to the focal population. The coefficient of kinship between an immigrant and all other individuals (including native individuals and other immigrants) always equals zero ($k_{ij}=0$). Because kinship coefficient values are calculated directly from the pedigree of the focal population, the addition of immigrants thereby introduces non-kin into the population at a consistent rate and prevents the mean kinship coefficient of the population from asymptoting to a value of 1 over generations. If the focal population was instead closed ($\rho=0$), then all alleles would quickly be expected to become identical-by-descent among descendants of the ancestral population. To avoid having immigrants affect the evolution of tendency for polyandry ($P_{p}$), inbreeding mating strategy ($M_{p}$), and inbreeding fertilisation strategy ($F_{p}$), immigrants are always male and can therefore be chosen based on their kinship values of zero but not actively affect reproductive decisions through the expression of $P_{p}$, $M_{p}$, or $F_{p}$. To further avoid having immigrants affect evolutionary dynamics, allele values underlying tendency for polyandry ($P_{a}$), inbreeding mating strategy ($M_{a}$), and inbreeding fertilisation strategy ($F_{a}$) are randomly sampled from normal distributions with means and standard deviations of $P_{a}$, $M_{a}$, and $F_{a}$ values equal to the means and standard deviations of those in the focal population at the time of immigration. Overall, this model of immigration effectively assumes that the focal population receives immigrants from other nearby populations that are subject to the same selection on $P_{p}$, $M_{p}$, and $F_{p}$.

Density regulation
----------------------------------------------

To avoid indefinite population growth over generations, we introduce a separate carrying capacity on the total number of females ($K_{f}$) and males ($K_{m}$) in the focal population following immigration [@Guillaume2009; @Duthie]. If at the end of a generation the number of females or males exceeds their respective carrying capacities, then each sex is reduced back to its $K_{f}$ or $K_{m}$ by randomly removing females and males until each sex is at its carrying capacity. Removal of females and males can be interpreted as dispersal outside the focal population, mortality, or as some combination of dispersal and mortality. The remaining females and males within the population form the next generation of adults.

Model analysis
----------------------------------------------

To analyse our model, we track mean values of alleles underlying tendency for polyandry ($P_{a}$), inbreeding mating strategy ($M_{a}$), and inbreeding fertilisation strategy ($F_{a}$) in a focal population. We present evolutionary dynamics of these mean allele values across a range of costs and inbreeding depression slopes using two types of simulations. First, we consider eight possible cost parameter combinations in which costs of tendency for polyandry ($c_{P}$), inbreeding mating strategy ($c_{M}$), and inbreeding fertilisation strategy ($c_{F}$) equal either $0$ or $0.02$ [@Duthie observed $0.02$ to be strong cost of tendency for polyandry]. Second, we fix $c_{P}$ to values of $0$, $0.01$, or $0.02$, then randomly select $c_{M}$ and $c_{F}$ values between $0-0.05$ for simulation initial starting conditions. The objective of the first type of simulation is to test how mean allele values change over generations in response to different combinations of costs and inbreeding depression slopes. The objective the second type of simulation is to predict selection for tendency for polyandry, inbreeding mating strategy, and inbreeding fertilisation strategy, across a wider range of parameter combinations, and to therefore test under what conditions each is predicted to evolve given different combinations of costs and inbreeding depression slopes.

In the first type of simulation, we record dynamics of mean values of $P_{a}$, $M_{a}$, $F_{a}$ over generations for every possible combination in which the cost associated with each of the three phenotypes ($c_{P}$, $c_{M}$, and $c_{F}$) is either $0$ or $0.02$, and for four slopes of inbreeding depression on offspring viability $\beta = {0, 1, 2, 3}$. Each possible cost combination is replicated ten times, and grand mean values and standard deviation of means is calculated in each generation across replicate simulations. These analyses allowed us to infer how allele values change over generations in response to costs, but also in response to the changing values of other alleles and therefore potentially interacting phenotypes (e.g., selection on inbreeding fertilisation strategy might be weak if polyandry is rare).

In the second type of simulation, we record and present mean values of $P_{a}$, $M_{a}$, $F_{a}$ only from the terminal generation of simulations, and for random costs of inbreeding mating strategy $c_{M} \in [0, 0.05]$ and inbreeding fertilisation strategy $c_{F} \in [0, 0.05]$, but fixed costs of tendency for polyandry $c_{P} = {0, 0.01, 0.02}$. We consider four values of $\beta = {0, 1, 2, 3}$, and we simulate 100 replicates for all combinations of $c_{P}$ and $\beta$. For different values of $\beta$ given the same $c_{P}$ value, we use the same randomly selected values of $c_{M}$ and $c_{F}$ to better infer how terminal mean allele values are affected by different magnitudes of inbreeding depression. We do not use the same randomly selected values of $c_{M}$ and $c_{F}$ across different values of $c_{P}$ because $c_{P}$ values were fixed *a priori* only to facilitate model inference. The objective of randomising costs was to sample from a broad range of parameter space, and this range is increased by selecting different $c_{M}$ and $c_{F}$ values for each $c_{P}$. 

For each replicate simulation with a unique set of costs, we classify the evolutionary outcome of inbreeding stragies in the simulation in one of four ways: (1) Weak selection for inbreding mating strategy and inbreeding fertilisation strategy, (2) weak selection for inbreeding mating strategy and strong selection for inbreeding fertilisation strategy, (3) strong selection for inbreeding mating strategy and weak selection for inbreeding fertilisation strategy, and (4) strong selection for inbreeding mating strategy and inbreeding fertilisation strategy. We additionally classify the evolutionary outcome of tendency for polyandry in the simulation as either weak selection for polyandry or strong selection for polyandry. @Duthie showed that selection for inbreeding preference (positive values of $M_{a}$) is predicted when inbreeding depression on offspring viability is $\beta=0$, but selection for inbreeding avoidance (negative values of $M_{a}$) is predicted when $\beta \geq 1$. When referring to strong selection for inbreeding mating strategy and inbreeding fertilisation strategy, we therefore refer specifically to inbreeding preference when $\beta=0$ and inbreeding avoidance when $\beta \geq 1$. Strong selection is inferred when mean allele values exceed $1$ (when $\beta = 0$) or are less than $-1$ (when $\beta \geq 1$), otherwise selection is inferred to be weak. Exploratory simulations suggest that cutoff values of $1$ and $-1$ are conservative for inferring when selection is strong, and other cutoff values do not change the general pattern of evolutionary outcomes (1-4) across cost parameter values.

For all replicates in both the first and second simulation types, we set the maximum number of generations to 5000, which exploratory simulations and previous modelling [@Duthie] showed to be a sufficient number of generations for inferring long-term dynamics of mean allele values and therefore selection on phenotypes. For all replicates, we set the number of immigrants per generation to $\rho=5$, which produced a range of kin and non-kin in each generation such that females could express inbreeding strategies. Females always produced $n=8$ offspring, which was sufficient to keep populations consistently near carrying capacities and avoid population extinction. Carrying capacities for females ($K_{f}$) and males ($K_{m}$) were both set to 100 because previous modelling has shown that populations of this size are small enough that mating encounters between kin occur with sufficient frequency for selection on inbreeding strategy, but populations are also not so small that selection is typically overwhelmed by genetic drift (Duthie and Reid *in press*).



******************************


Results
===================================================


******************************

Discussion
===================================================


Acknowledgements
----------------------------------------------

This work was funded by a European Research Council Starting Grant to JMR. 

**************************


References
----------------------------------------------


